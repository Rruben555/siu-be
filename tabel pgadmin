CREATE TABLE users (
  user_id SERIAL PRIMARY KEY,
  nama VARCHAR(255) NOT NULL,
  nim VARCHAR(20) UNIQUE,
  email VARCHAR(255) UNIQUE NOT NULL,
  fakultas VARCHAR(255) NOT NULL,
  password TEXT NOT NULL,
  role VARCHAR(20) DEFAULT 'user' CHECK (role IN ('user', 'admin')),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ukm (
  ukm_id SERIAL PRIMARY KEY,
  nama VARCHAR(150) NOT NULL,
  deskripsi TEXT,
  gambar TEXT,
  wa_group TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE anggota (
  member_id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(user_id) ON DELETE CASCADE,
  ukm_id INT REFERENCES ukm(ukm_id) ON DELETE CASCADE,
  member_role VARCHAR(20) DEFAULT 'member' CHECK (member_role IN ('member','admin')),
  joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, ukm_id)
);


CREATE TABLE kegiatan (
  event_id SERIAL PRIMARY KEY,
  ukm_id INT REFERENCES ukm(ukm_id) ON DELETE CASCADE,
  nama VARCHAR(200) NOT NULL,
  deskripsi TEXT,
  tanggal DATE,
  lokasi VARCHAR(200),
  status VARCHAR(20) DEFAULT 'open' CHECK (status IN ('open','closed','done')),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE participant (
  participant_id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(user_id) ON DELETE CASCADE,
  event_id INT REFERENCES kegiatan(event_id) ON DELETE CASCADE,
  registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, event_id)
);

CREATE TABLE laporan (
  report_id SERIAL PRIMARY KEY,
  ukm_id INT REFERENCES ukm(ukm_id) ON DELETE CASCADE,
  event_id INT REFERENCES kegiatan(event_id) ON DELETE SET NULL,
  peserta INTEGER DEFAULT 0,
  biaya VARCHAR(100),
  catatan TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
